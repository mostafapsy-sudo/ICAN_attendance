<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… I CAN</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: linear-gradient(135deg, #004d40, #002f6c);
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header-logo {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 80px; /* Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ */
    height: 80px; /* Ù„Ø§Ø²Ù… Ø§Ù„Ø·ÙˆÙ„ ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ Ø¯Ø§Ø¦Ø±Ø© Ù…Ø¸Ø¨ÙˆØ·Ø© */
    z-index: 1000;
    
    /* Ø¬Ø¹Ù„ Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙƒÙŠØ±ÙÙŠ (Ø¯Ø§Ø¦Ø±ÙŠ) */
    border-radius: 50%; 
    
    /* Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ø³Ø© Ø¬Ù…Ø§Ù„ÙŠØ© (Ø¥Ø·Ø§Ø± ÙˆØ´Ù„) */
    border: 3px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    
    /* Ø¹Ø´Ø§Ù† Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ù…Ù† ØºÙŠØ± Ù…Ø§ ØªØ¨ÙˆØ¸ */
    object-fit: cover; 
    background-color: white; /* Ù„Ùˆ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ù…Ù„ÙˆØ´ Ø®Ù„ÙÙŠØ© */
}
        .i-can-bg {
            font-size: 100px; font-weight: bold; color: rgba(255, 255, 255, 0.03);
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: -1; pointer-events: none;
        }

        .screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px;
        }

        .hidden { display: none !important; }

        .top-back-btn {
            position: absolute; top: 20px; left: 20px; background: #555; color: white;
            padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer;
            font-size: 16px; font-weight: bold; z-index: 1000;
        }

        .container {
            background: rgba(255, 255, 255, 0.15); padding: 30px; border-radius: 25px;
            backdrop-filter: blur(15px); box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            max-width: 900px; width: 95%; margin: 20px auto; max-height: 80vh; overflow-y: auto;
            position: relative;
        }

        .attendance-buttons-row { display: flex; gap: 15px; width: 100%; margin: 25px 0; }
        .record-btn {
            flex: 1; padding: 20px; border-radius: 15px; color: white; font-weight: bold;
            cursor: pointer; border: none; font-size: 16px; transition: 0.3s;
        }
        .in-btn { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
        .out-btn { background: linear-gradient(135deg, #2196F3, #1976D2); }
        .record-btn:disabled { background: #888; cursor: not-allowed; opacity: 0.6; }

        .main-btn {
            padding: 25px; font-size: 28px; border: none; border-radius: 15px; cursor: pointer;
            font-weight: bold; color: white; width: 100%; max-width: 400px; margin-bottom: 20px;
        }
        .admin-btn { background: linear-gradient(135deg, #9c27b0, #673ab7); }
        .spec-btn { background: linear-gradient(135deg, #2196f3, #00bcd4); }

        .attendance-grid {
            display: grid; grid-template-columns: 0.5fr 1fr 1fr 0.8fr 0.8fr 0.8fr;
            gap: 10px; background: rgba(255, 255, 255, 0.95); color: #333; margin: 10px 0;
            padding: 12px; border-radius: 10px; align-items: center; font-size: 13px;
        }
        .stat-box { background: #eee; padding: 5px; border-radius: 5px; cursor: pointer; }
        .stat-box:hover { background: #ddd; }

        .report-card { background: white; color: #333; padding: 15px; border-radius: 12px; margin-bottom: 10px; text-align: right; line-height: 1.6; }

        input { padding: 15px; border-radius: 10px; border: none; width: 80%; max-width: 300px; font-size: 18px; margin: 10px 0; }
        .action-btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: #4CAF50; color: white; }

        /* Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±Ø³ */
        .settings-trigger {
            position: absolute; bottom: 15px; left: 15px;
            background: rgba(255,255,255,0.2); border: none; border-radius: 50%;
            width: 45px; height: 45px; cursor: pointer; font-size: 22px;
            display: flex; align-items: center; justify-content: center;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; align-items: center; 
            justify-content: center; z-index: 3000;
        }
        .modal-content { 
            background: #fff; color: #333; padding: 25px; 
            border-radius: 20px; width: 85%; max-width: 350px; 
        }
    </style>
</head>
<body>
    <body>
    <img src="logo.png" alt="I CAN Logo" class="header-logo">
    
    <div class="i-can-bg">I CAN</div>
    ... 

    <div class="i-can-bg">I CAN</div>

    <div id="mainScreen" class="screen">
        <img src="logo.png" alt="I CAN" class="header-logo">
        <h1 style="font-size: 50px; margin-bottom: 50px;">I CAN</h1>
        <button class="main-btn admin-btn" onclick="showScreen('adminLoginScreen')">ğŸ‘‘ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        <button class="main-btn spec-btn" onclick="showScreen('specialistMonthScreen')">ğŸ‘¤ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ</button>
    </div>

    <div id="adminLoginScreen" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('mainScreen')">ğŸ”™</button>
        <div class="container">
            <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
            <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <br>
            <button class="action-btn" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="adminControlPanel" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('mainScreen')">ğŸ”™</button>
        <div class="container">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <div style="margin: 20px 0;">
                <input type="text" id="newSpecName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <button class="action-btn" onclick="addSpecialist()">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            <div id="specialistsList" style="margin-bottom: 20px;"></div>
            <button class="action-btn" style="background:#17a2b8" onclick="viewReports()">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="action-btn" style="background:#f44336" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            
            <button class="settings-trigger" onclick="toggleModal(true)">âš™ï¸</button>
        </div>
    </div>

   <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h3>âš™ï¸ ØªØ®ØµÙŠØµ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ§Ù…</h3>
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ:</label>
            <select id="selectSpecToEdit" style="padding:10px; width:90%; border-radius:8px; margin:10px 0;">
                <option value="default">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ù„ÙƒÙ„)</option>
            </select>
            
            <label>ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±:</label>
            <input type="time" id="configInTime">
            <label>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù:</label>
            <input type="time" id="configOutTime">
            
            <button class="action-btn" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            <button onclick="toggleModal(false)" style="background:none; border:none; color:red; margin-top:10px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    <div id="reportScreen" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('adminControlPanel')">ğŸ”™</button>
        <div class="container">
            <h2>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
            <div id="reportContainer" style="margin-top: 20px;"></div>
        </div>
    </div>

    <div id="specialistMonthScreen" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('mainScreen')">ğŸ”™</button>
        <div class="container">
            <h2>Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±</h2>
            <div id="monthButtons" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;"></div>
        </div>
    </div>

    <div id="specPassScreen" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('specialistMonthScreen')">ğŸ”™</button>
        <div class="container">
            <h2>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h2>
            <input type="password" id="specPass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
            <br>
            <button class="action-btn" onclick="verifySpec()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="attendanceScreen" class="screen hidden">
        <button class="top-back-btn" onclick="showScreen('specialistMonthScreen')">ğŸ”™</button>
        <div class="container">
            <h2 id="monthTitle">ğŸ“…</h2>
            <div style="background: white; color: #333; padding: 10px; border-radius: 10px; margin: 10px 0;">
                <h3>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ: <span id="currentSpecName"></span></h3>
            </div>

            <div class="attendance-buttons-row">
                <button id="inBtn" class="record-btn in-btn" onclick="recordIn()">Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±</button>
                <button id="outBtn" class="record-btn out-btn" onclick="recordOut()">Ø³Ø¬Ù„ Ø§Ù†ØµØ±Ø§Ù</button>
            </div>

            <div class="attendance-grid" style="background: #002f6c; color: white;">
                <span>ÙŠÙˆÙ…</span><span>Ø­Ø¶ÙˆØ±</span><span>Ø§Ù†ØµØ±Ø§Ù</span><span>ØªØ£Ø®ÙŠØ±</span><span>Ù…Ø¨ÙƒØ±</span><span>Ø¥Ø¶Ø§ÙÙŠ</span>
            </div>
            <div id="daysList"></div>
        </div>
    </div>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
      const firebaseConfig = {
  apiKey: "AIzaSyA5btGtTXfLti7vipnCgkv0Zy2-ry8lxME",
  authDomain: "anas-attedendence-2.firebaseapp.com",
  projectId: "anas-attedendence-2",
  storageBucket: "anas-attedendence-2.firebasestorage.app",
  messagingSenderId: "474174822973",
  appId: "1:474174822973:web:8c9f8659c5970145c46854",
  measurementId: "G-LFBDLR30LQ"
};

        let specialists = JSON.parse(localStorage.getItem('ican_specs')) || [];
        let attendance = JSON.parse(localStorage.getItem('ican_att')) || {};
        let timeConfig = JSON.parse(localStorage.getItem('ican_time_config')) || { in: "08:30", out: "16:30" };
        let selMonth = null, selMonthName = "", selSpec = null;
        let isAdminActive = false;
        const now = new Date();

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'specialistMonthScreen') { loadMonths(); isAdminActive = false; }
            if(id === 'adminControlPanel') { loadSpecsList(); isAdminActive = true; }
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­Ù‡Ø§
        function toggleModal(show) {
            const modal = document.getElementById('settingsModal');
            modal.style.display = show ? 'flex' : 'none';
            
            if(show) {
                const select = document.getElementById('selectSpecToEdit');
                // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¦Ù‡Ø§ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†
                select.innerHTML = '<option value="default">Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ù„ÙƒÙ„)</option>';
                specialists.forEach(s => {
                    select.innerHTML += `<option value="${s.name}">${s.name}</option>`;
                });
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø´Ø®Øµ Ù…Ø­Ø¯Ø¯ Ø£Ùˆ Ù„Ù„ÙƒÙ„
        function saveSettings() {
            const target = document.getElementById('selectSpecToEdit').value;
            const newTimes = {
                in: document.getElementById('configInTime').value,
                out: document.getElementById('configOutTime').value
            };

            if (target === "default") {
                // Ø­ÙØ¸ Ù„Ù„ÙƒÙ„
                timeConfig = newTimes;
                localStorage.setItem('ican_time_config', JSON.stringify(timeConfig));
            } else {
                // Ø­ÙØ¸ Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
                if (!window.specCustomTimes) window.specCustomTimes = JSON.parse(localStorage.getItem('ican_spec_custom_times')) || {};
                window.specCustomTimes[target] = newTimes;
                localStorage.setItem('ican_spec_custom_times', JSON.stringify(window.specCustomTimes));
            }

            alert("âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ§Ù… Ù„Ù€: " + (target === "default" ? "Ø§Ù„Ø¬Ù…ÙŠØ¹" : target));
            toggleModal(false);
        }

        // ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„ØªØ£Ø®Ø° Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø®ØµØµØ© ÙÙŠ Ø§Ù„Ø§Ø¹ØªØ¨Ø§Ø±
        function recordIn() {
            const t = new Date();
            const time = t.getHours() + ":" + t.getMinutes().toString().padStart(2, '0');
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ø¥Ù† ÙˆØ¬Ø¯ØªØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const customTimes = JSON.parse(localStorage.getItem('ican_spec_custom_times')) || {};
            const activeTime = customTimes[selSpec.name] || timeConfig;
            
            const [h, m] = activeTime.in.split(':');
            const limit = new Date(); limit.setHours(h, m, 0);
            
            let delay = t > limit ? Math.floor((t - limit) / 60000) : 0;
            saveData(now.getDate(), { in: time, delay: delay });
        }
        function loginAdmin() {
            if(document.getElementById('adminPassword').value === "1234") showScreen('adminControlPanel');
            else alert("Ø®Ø·Ø£");
        }

        function loadSpecsList() {
            const list = document.getElementById('specialistsList');
            list.innerHTML = specialists.map((s, i) => `
                <div style="background:white; color:#333; padding:10px; margin:5px; border-radius:8px; display:flex; justify-content:space-between;">
                    ${s.name} <button onclick="deleteSpec(${i})" style="color:red; border:none; background:none; cursor:pointer;">Ø­Ø°Ù</button>
                </div>
            `).join('');
        }

        function addSpecialist() {
            const name = document.getElementById('newSpecName').value;
            if(name) {
                specialists.push({ name: name, pass: name + "1" });
                localStorage.setItem('ican_specs', JSON.stringify(specialists));
                loadSpecsList();
                document.getElementById('newSpecName').value = "";
            }
        }

        function deleteSpec(i) {
            if(confirm("Ø­Ø°ÙØŸ")) { specialists.splice(i, 1); localStorage.setItem('ican_specs', JSON.stringify(specialists)); loadSpecsList(); }
        }

        // --- Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø§Ù„Ø¨ØµÙ…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
        async function verifySpec() {
            const p = document.getElementById('specPass').value;
            const s = specialists.find(x => x.pass === p);
            if(s) {
                if (window.PublicKeyCredential) {
                    alert("ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø¹Ø¨Ø± Ø¨ØµÙ…Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„...");
                    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© ØªØªØ·Ù„Ø¨ HTTPS ÙˆØ³ÙŠØ±ÙØ±ØŒ Ù‡Ù†Ø§ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø¹Ø¨Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²
                }
                selSpec = s;
                document.getElementById('currentSpecName').textContent = s.name;
                document.getElementById('monthTitle').textContent = "Ø´Ù‡Ø± " + selMonthName;
                showScreen('attendanceScreen');
                loadDays();
            } else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±Ù…Ø²");
        }

        // --- Ø³Ù„Ø·Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª ---
        function editTime(day, field) {
            if(!isAdminActive) return;
            let newVal = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ‚Øª Ø£Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", attendance[selSpec.name][selMonth][day][field] || "");
            if(newVal !== null) {
                if(!attendance[selSpec.name]) attendance[selSpec.name] = {};
                if(!attendance[selSpec.name][selMonth]) attendance[selSpec.name][selMonth] = {};
                attendance[selSpec.name][selMonth][day][field] = newVal;
                localStorage.setItem('ican_att', JSON.stringify(attendance));
                loadDays();
            }
        }

        function loadDays() {
            const container = document.getElementById('daysList');
            container.innerHTML = "";
            const daysCount = new Date(2026, selMonth, 0).getDate();
            for(let d = 1; d <= daysCount; d++) {
                const data = (attendance[selSpec.name] && attendance[selSpec.name][selMonth]) ? attendance[selSpec.name][selMonth][d] || {} : {};
                container.innerHTML += `
                    <div class="attendance-grid">
                        <span>${d}</span>
                        <span class="stat-box" onclick="editTime(${d}, 'in')">${data.in || '-'}</span>
                        <span class="stat-box" onclick="editTime(${d}, 'out')">${data.out || '-'}</span>
                        <span class="stat-box" onclick="editTime(${d}, 'delay')">${data.delay || 0}Ø¯</span>
                        <span class="stat-box" onclick="editTime(${d}, 'early')">${data.early || 0}Ø¯</span>
                        <span class="stat-box" onclick="editTime(${d}, 'over')">${data.over || 0}Ø¯</span>
                    </div>`;
            }
            updateBtns();
        }

        function updateBtns() {
            const d = now.getDate();
            const data = (attendance[selSpec.name] && attendance[selSpec.name][selMonth]) ? attendance[selSpec.name][selMonth][d] || {} : {};
            document.getElementById('inBtn').disabled = !!data.in;
            document.getElementById('outBtn').disabled = !data.in || !!data.out;
        }

        function recordIn() {
            const t = new Date();
            const time = t.getHours() + ":" + t.getMinutes().toString().padStart(2, '0');
            const [h, m] = timeConfig.in.split(':');
            const limit = new Date(); limit.setHours(h, m, 0);
            let delay = t > limit ? Math.floor((t - limit) / 60000) : 0;
            saveData(now.getDate(), { in: time, delay: delay });
        }

        function recordOut() {
            const t = new Date();
            const time = t.getHours() + ":" + t.getMinutes().toString().padStart(2, '0');
            const [h, m] = timeConfig.out.split(':');
            const limit = new Date(); limit.setHours(h, m, 0);
            let early = t < limit ? Math.floor((limit - t) / 60000) : 0;
            let over = t > limit ? Math.floor((t - limit) / 60000) : 0;
            saveData(now.getDate(), { out: time, early: early, over: over });
        }

        function saveData(day, obj) {
            if(!attendance[selSpec.name]) attendance[selSpec.name] = {};
            if(!attendance[selSpec.name][selMonth]) attendance[selSpec.name][selMonth] = {};
            attendance[selSpec.name][selMonth][day] = { ...attendance[selSpec.name][selMonth][day], ...obj };
            localStorage.setItem('ican_att', JSON.stringify(attendance));
            loadDays();
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
        }

        function loadMonths() {
            const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
            const div = document.getElementById('monthButtons');
            div.innerHTML = "";
            months.forEach((m, i) => {
                const b = document.createElement('button');
                b.className = "action-btn";
                b.style.background = (i + 1 === now.getMonth() + 1) ? "#f39c12" : "#2196f3";
                b.textContent = m;
                b.onclick = () => { selMonth = i + 1; selMonthName = m; showScreen('specPassScreen'); };
                div.appendChild(b);
            });
        }

        function viewReports() {
            showScreen('reportScreen');
            const container = document.getElementById('reportContainer');
            container.innerHTML = "";
            specialists.forEach(spec => {
                let totalDelay = 0, totalOver = 0, totalEarly = 0, days = 0;
                const monthData = attendance[spec.name]?.[now.getMonth() + 1] || {};
                Object.values(monthData).forEach(d => {
                    totalDelay += parseInt(d.delay || 0);
                    totalOver += parseInt(d.over || 0);
                    totalEarly += parseInt(d.early || 0);
                    if(d.in) days++;
                });
                container.innerHTML += `<div class="report-card"><strong>Ø§Ù„Ø£Ø®ØµØ§Ø¦ÙŠ: ${spec.name}</strong><br>ğŸ“… Ø§Ù„Ø¹Ù…Ù„: ${days} ÙŠÙˆÙ… | â° ØªØ£Ø®ÙŠØ±: ${totalDelay}Ø¯ | â• Ø¥Ø¶Ø§ÙÙŠ: ${totalOver}Ø¯</div>`;
            });
        }

        function clearAllData() { if(confirm("Ù…Ø³Ø­ØŸ")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
